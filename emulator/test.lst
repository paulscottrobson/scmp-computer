 AS V1.42 Beta [Bld 115] - source file test.asm - page 1 - 15/11/2017 18:16:16


       1/       0 :                     ; ***********************************************************************************************
       2/       0 :                     ;
       3/       0 :                     ;					Bootloader 2. Displays AAA.DDD in octal. Writes to page 1xx
       4/       0 :                     ;
       5/       0 :                     ; ***********************************************************************************************
       6/       0 :                     
       7/       0 :                     	cpu 	sc/mp
       8/       0 :                     
       9/       0 :                     
      10/       0 :                     bootloader:
      11/       0 : 08                  	nop 								
      12/       1 :                     
      13/       1 :                     RepaintBuffer:
      14/       1 : C4 F2               	ldi 	0xF2 								; put C in start of buffer
      15/       3 : C8 42               	st 		buffer
      16/       5 : C4 46               	ldi 	buffer 								; buffer
      17/       7 :                     __RPEntry:	
      18/       7 : 31                  	xpal 	p1
      19/       8 :                     RepaintBufferChar:
      20/       8 : 19                  	sio 										; wait for code.
      21/       9 : 40                  	lde
      22/       A : 94 F5               	jp 		RepaintBuffer
      23/       C : 8F 00               	dly 	00
      24/       E : C4 70               	ldi 	0x70 								; counter
      25/      10 :                     __RPLoop:
      26/      10 : 01                  	xae
      27/      11 : 06                  	csa 										; check for key press
      28/      12 : D4 30               	ani 	0x30
      29/      14 : 98 02               	jz 		__RPNoKey
      30/      16 : 40                  	lde											; key pressed, put in P2.L
      31/      17 : 32                  	xpal 	p2
      32/      18 :                     __RPNoKey:
      33/      18 : C1 00               	ld 		(p1) 								; is it the current character ?
      34/      1A : 60                  	xre
      35/      1B : D4 F0               	ani 	0xF0
      36/      1D : 9C 05               	jnz 	__RPNoSet
      37/      1F : C1 00               	ld 		(p1) 								; re-read it
      38/      21 : D4 03               	ani 	0x03 	 							; isolate the flag bits
      39/      23 : 07                  	cas 										; copy to Status register
      40/      24 :                     __RPNoSet:
      41/      24 : 8F 03               	dly 	03 									; next Data line
      42/      26 : C4 10               	ldi 	0x10 								; A = $10, also used to Clear F0,F1 and CY/L
      43/      28 : 07                  	cas											
      44/      29 : 70                  	ade											; add current position to it.
      45/      2A : 9C E4               	jnz 	__RPLoop
      46/      2C : C4 72               	ldi 	0x72 								; overwrite character with zero
      47/      2E : CD 01               	st 		@1(p1) 								; and point to next character
      48/      30 : C1 00               	ld 		(p1)								; read the next character
      49/      32 : 9C D4               	jnz 	RepaintBufferChar
      50/      34 : C8 18               	st 		emptybuffer 						; make sure emptybuffer is empty
      51/      36 :                     
      52/      36 : 32                  	xpal 	p2 									; if non-zero key pressed, also clears P2.L
      53/      37 : 9C 06               	jnz 	__KeyPressed
      54/      39 :                     
      55/      39 :                     __KeepScanning:
      56/      39 : C8 0B               	st 		lastkey 							; save as last key pressed.
      57/      3B :                     __KeepScanningNoLK:
      58/      3B : C4 4D               	ldi 	emptybuffer 						; redo with an empty buffer, just scan keyboard	
      59/      3D : 90 C8               	jmp 	__RPEntry
      60/      3F :                     
 AS V1.42 Beta [Bld 115] - source file test.asm - page 2 - 15/11/2017 18:16:16


      61/      3F :                     __KeyPressed:
      62/      3F : E0 05               	xor 	lastkey 					
      63/      41 : 98 F8               	jz 		__KeepScanningNoLK
      64/      43 :                     
      65/      43 : 90 FE               w1:	jmp 	w1
      66/      45 :                     
      67/      45 :                     lastkey:
      68/      45 : 00                  	db 		0
      69/      46 :                     
      70/      46 :                     buffer:
      71/      46 : 72                  	db 		0x72 								; 'C'											
      72/      47 : 72 72 72 72 72 72   	db 		0x72,0x72,0x72,0x72,0x72,0x72		; 0 0 0 0 0 0
      73/      4D :                     emptybuffer:
      74/      4D : 00 00               	db 		0,0 								; a buffer with nothing in it.
      75/      4F :                     
      76/      4F :                     
      77/      4F : FF                  	db 		0xFF	
 AS V1.42 Beta [Bld 115] - source file test.asm - page 3 - 15/11/2017 18:16:16


  symbol table (* = unused):
  ------------------------

*ARCHITECTURE :                                        x86_64-unknown-linux - |
*BIGENDIAN :                      0 - | *BOOTLOADER :                     0 C |
*BRANCHEXT :                      0 - |  BUFFER :                        46 C |
*CASESENSITIVE :                  0 - | *CONSTPI :        3.141592653589793 - |
*DATE :                  15/11/2017 - |  EMPTYBUFFER :                   4D C |
*FALSE :                          0 - | *FULLPMMU :                       1 - |
*HAS64 :                          1 - | *HASDSP :                         0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
*INEXTMODE :                      0 - | *INLWORDMODE :                    0 - |
*INMAXMODE :                      0 - | *INSRCMODE :                      0 - |
*INSUPMODE :                      0 - |  LASTKEY :                       45 C |
*LISTON :                         1 - | *MACEXP :                         1 - |
*MOMCPU :                         C - | *MOMCPUNAME :                 SC/MP - |
*NESTMAX :                      100 - | *PACKING :                        0 - |
*PADDING :                        1 - | *RELAXED :                        0 - |
 REPAINTBUFFER :                  1 C |  REPAINTBUFFERCHAR :              8 C |
*TIME :                    18:16:16 - | *TRUE :                           1 - |
*VERSION :                     142F - |  W1 :                            43 C |
*__KEEPSCANNING :                39 C |  __KEEPSCANNINGNOLK :            3B C |
 __KEYPRESSED :                  3F C |  __RPENTRY :                      7 C |
 __RPLOOP :                      10 C |  __RPNOKEY :                     18 C |
 __RPNOSET :                     24 C |

     42 symbols
     30 unused symbols

 AS V1.42 Beta [Bld 115] - source file test.asm - page 4 - 15/11/2017 18:16:16


  codepages:
  ----------

STANDARD (0 changed characters)


0.00 seconds assembly time

     77 lines source file
      2 passes
      0 errors
      0 warnings
